<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>Hansae Auction – 관리자 페이지</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Apple SD Gothic Neo", sans-serif;
      margin: 0;
      background: #f3f4f6;
    }
    .wrap {
      max-width: 960px;
      margin: 30px auto;
      background: #fff;
      padding: 20px 22px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(15,23,42,0.12);
      border: 1px solid #e5e7eb;
    }
    h1 { margin-top: 0; font-size: 22px; }
    h2 { margin-top: 24px; font-size: 16px; }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-top: 8px;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 6px 8px;
      text-align: left;
    }
    th {
      background: #f9fafb;
      font-weight: 600;
    }
    .badge {
      display: inline-flex;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      background: #eff6ff;
      color: #1d4ed8;
    }
    .tag-admin {
      background: #fee2e2;
      color: #b91c1c;
    }
    .warn {
      font-size: 12px;
      color: #ef4444;
      margin-top: 6px;
    }
  </style>
</head>
<body>
<div class="wrap">
  <h1>관리자 페이지</h1>
  <div id="welcome"></div>

  <h2>가입자 목록</h2>
  <p style="font-size:12px;color:#6b7280;">
    이 브라우저(localStorage)에 저장된 이메일/역할 정보만 표시됩니다.
  </p>
  <div id="usersTableWrap"></div>

  <!-- 여기 아래에다가 물품 등록/수정 UI 추가하시면 됩니다 -->
  <h2 style="margin-top:32px;">물품 관리 (LOT 등록/수정)</h2>
  <p style="font-size:12px;color:#6b7280;">
    여기에 LOT 등록/수정 폼을 붙이면, 관리자인 경우에만 접근할 수 있게 됩니다.
  </p>
</div>

<script>
  const USER_KEY = "charityAuctionUser";
  const USERS_LIST_KEY = "charityAuctionUsers";

  function loadCurrentUser() {
    const raw = localStorage.getItem(USER_KEY);
    if (!raw) return null;
    try { return JSON.parse(raw); } catch { return null; }
  }

  function loadUsersList() {
    const raw = localStorage.getItem(USERS_LIST_KEY);
    if (!raw) return [];
    try { return JSON.parse(raw); } catch { return []; }
  }

  // 1) 관리자만 접근하도록 가드
  (function guard() {
    const user = loadCurrentUser();
    if (!user) {
      alert("먼저 로그인 페이지에서 입장해 주세요.");
      window.location.href = "index.html";
      return;
    }
    if (user.role !== "admin") {
      alert("관리자 전용 페이지입니다. 참여자는 카탈로그 화면으로 이동합니다.");
      window.location.href = "catalog.html";
      return;
    }
  })();

  // 2) 화면 렌더링
  (function render() {
    const user = loadCurrentUser();
    const welcome = document.getElementById("welcome");
    welcome.innerHTML =
      `<p style="font-size:13px;color:#4b5563;">
        현재 로그인: <b>${user.email}</b>
        <span class="badge tag-admin" style="margin-left:6px;">관리자</span>
      </p>`;

    const users = loadUsersList();
    const wrap = document.getElementById("usersTableWrap");

    if (!users.length) {
      wrap.innerHTML = '<p class="warn">저장된 가입자 정보가 없습니다.</p>';
      return;
    }

    const rows = users.map((u, i) => {
      const date = u.joinedAt ? new Date(u.joinedAt).toLocaleString() : "-";
      const roleLabel = u.role === "admin" ? "관리자" : "참여자";
      const roleClass = u.role === "admin" ? "badge tag-admin" : "badge";

      return `
        <tr>
          <td>${i + 1}</td>
          <td>${u.email}</td>
          <td><span class="${roleClass}">${roleLabel}</span></td>
          <td>${date}</td>
        </tr>
      `;
    }).join("");

    wrap.innerHTML = `
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>이메일</th>
            <th>역할</th>
            <th>가입/최초 로그인 시각</th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>
    `;
  })();
</script>
</body>
</html>
