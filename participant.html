<html lang="ko"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hansae Charity Auction â€“ ì°¸ì—¬ì ë¡œê·¸ì¸</title>
  <style>
    :root {
      --blue: #3182f6;
      --blue-soft: #e8f2ff;
      --bg: #f5f7fb;
      --text: #111827;
      --muted: #6b7280;
      --border: #e5e7eb;
      --card: #ffffff;
      --danger: #ef4444;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: radial-gradient(circle at top, #eef3ff 0, #f5f7fb 40%, #edf2ff 100%);
      color: var(--text);
      font-family: system-ui, -apple-system, BlinkMacSystemFont,
        "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .app { flex: 1; display: flex; flex-direction: column; }
    .topbar {
      position: sticky; top: 0; z-index: 10;
      background: rgba(245, 247, 251, 0.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(229, 231, 235, 0.8);
    }
    .topbar-inner {
      max-width: 960px;
      margin: 0 auto;
      padding: 14px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .brand { display: flex; align-items: center; gap: 10px; }
    .brand-logo {
      width: 32px; height: 32px;
      border-radius: 12px;
      background: linear-gradient(135deg, #3182f6, #4f46e5);
      display: flex; align-items: center; justify-content: center;
      color: #fff; font-weight: 800; font-size: 17px;
    }
    .brand-text-main { font-weight: 700; font-size: 16px; }
    .brand-text-sub { font-size: 11px; color: var(--muted); }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .pill {
      background: #eff4ff;
      color: #1d4ed8;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 500;
    }

    .nickname-pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 4px 10px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      font-size: 11px;
      font-weight: 600;
    }

    .btn-logout {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
    }

    .main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 24px 16px 32px;
    }
    .card {
      width: 100%;
      max-width: 420px;
      background: var(--card);
      border-radius: 20px;
      border: 1px solid var(--border);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.12);
      padding: 24px 22px 20px;
    }
    .card-header { margin-bottom: 14px; }
    .card-title { font-size: 20px; font-weight: 700; margin-bottom: 4px; }
    .card-subtitle { font-size: 12px; color: var(--muted); line-height: 1.5; }
    .badge-soft {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-top: 8px;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: var(--blue-soft);
      color: #1d4ed8;
    }
    form {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    label {
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 2px;
      display: block;
    }
    input[type="email"],
    input[type="password"],
    input[type="text"] {
      width: 100%;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #ffffff;
      padding: 9px 12px;
      font-size: 13px;
      color: var(--text);
      outline: none;
      transition: border-color 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
    }
    input::placeholder { color: #9ca3af; }
    input:focus {
      border-color: var(--blue);
      box-shadow: 0 0 0 1px rgba(49, 130, 246, 0.1);
      background: #ffffff;
    }
    .input-group { margin-bottom: 2px; }
    .hint { font-size: 11px; color: var(--muted); margin-top: 2px; }
    .btn {
      border-radius: 999px;
      border: none;
      padding: 9px 14px;
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      text-decoration: none;
      transition: transform 0.08s ease, box-shadow 0.1s ease, background 0.12s ease;
      white-space: nowrap;
    }
    .btn-primary {
      background: var(--blue);
      color: #ffffff;
      box-shadow: 0 4px 10px rgba(37, 99, 235, 0.25);
      font-weight: 600;
      width: 100%;
      margin-top: 2px;
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.3);
    }
    .btn-ghost {
      background: transparent;
      color: var(--muted);
      font-size: 11px;
      padding: 4px 8px;
      box-shadow: none;
    }
    .btn-ghost:hover { text-decoration: underline; }
    .footer-row {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--muted);
    }
    .status { font-size: 11px; margin-top: 4px; min-height: 14px; }
    .status-ok { color: #16a34a; }
    .status-error { color: var(--danger); }
    footer {
      border-top: 1px solid #e5e7eb;
      background: #f9fafb;
      padding: 10px 20px 14px 20px;
      font-size: 11px;
      color: #9ca3af;
      margin-top: auto;
    }
    footer .inner {
      max-width: 960px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    /* ë¡œê·¸ì¸ ìœ ì§€ ìƒíƒœ ì „ìš© ì˜ì—­ */
    #loggedInView {
      display: none;
      flex-direction: column;
      gap: 10px;
      margin-top: 12px;
    }
  </style>

  <!-- EmailJS SDK (ì‚¬ìš© ì‹œì—ë§Œ ì„¤ì •) -->
  <script src="https://cdn.emailjs.com/sdk/3.11.0/email.min.js"></script>
  <script>
    // TODO: EmailJS Public Keyë¡œ êµì²´ (ì‚¬ìš©í•˜ì§€ ì•Šì„ ê²½ìš° ê·¸ëƒ¥ ë‘ë©´ ë¨)
    (function () {
      if (window.emailjs) {
        emailjs.init("YOUR_PUBLIC_KEY");
      }
    })();
  </script>
</head>
<body>
<div class="app">
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="brand-logo">H</div>
        <div>
          <div class="brand-text-main">Hansae Charity Auction</div>
          <div class="brand-text-sub">ì°¸ì—¬ì ì „ìš© ë¡œê·¸ì¸ í˜ì´ì§€</div>
        </div>
      </div>
      <div class="topbar-right">
        <!-- âœ… ë¡œê·¸ì¸ + ë‹‰ë„¤ì„ ì„¤ì • ì™„ë£Œ ì‹œì—ë§Œ ë³´ì´ëŠ” ì˜ì—­ -->
        <span class="nickname-pill" id="nicknameDisplay" style="display: inline-flex;">í°ì† ë‹˜</span>
        <button type="button" class="btn-ghost btn-logout" id="logoutBtn" style="display: inline-flex;">
          ë¡œê·¸ì•„ì›ƒ
        </button>
        <span class="pill" id="participantBadge">Participant Â· v1.0</span>
      </div>
    </div>
  </div>

  <main class="main">
    <div class="card">
      <div class="card-header">
        <div id="modeTitle" class="card-title">ì´ë¯¸ ë¡œê·¸ì¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤</div>
        <div id="modeSubtitle" class="card-subtitle">ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ì´ë¯¸ ë¡œê·¸ì¸ ìƒíƒœì…ë‹ˆë‹¤.<br>ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²½ë§¤ í˜ì´ì§€ë¡œ ì´ë™í•´ ì£¼ì„¸ìš”.</div>
      </div>

      <!-- âœ… 1ë‹¨ê³„: ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë“±ë¡ + ë¡œê·¸ì¸ -->
      <form id="authForm" style="display: none;">
        <div class="input-group">
          <label for="emailInput">ì´ë©”ì¼</label>
          <input type="email" id="emailInput" placeholder="ì˜ˆ: name@hansae.co.kr" autocomplete="email" required="">
          <div class="hint" id="emailHint">
            ì‚¬ë‚´ ì‚¬ìš© ëª©ì ì´ë¯€ë¡œ íšŒì‚¬ ë©”ì¼ ê³„ì •ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
          </div>
        </div>

        <div class="input-group">
          <label for="passwordInput" id="passwordLabel">ë¹„ë°€ë²ˆí˜¸ ì„¤ì •</label>
          <input type="password" id="passwordInput" placeholder="6ì ì´ìƒ ì…ë ¥í•´ ì£¼ì„¸ìš”." autocomplete="new-password" required="">
          <div class="hint" id="passwordHint">
            ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©°, ìµœì†Œ 6ì ì´ìƒì„ ê¶Œì¥ë“œë¦½ë‹ˆë‹¤.
          </div>
        </div>

        <div class="input-group" id="passwordConfirmGroup">
          <label for="passwordConfirmInput">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
          <input type="password" id="passwordConfirmInput" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ í•œ ë²ˆ ë” ì…ë ¥í•´ ì£¼ì„¸ìš”." autocomplete="new-password">
        </div>

        <button type="submit" class="btn btn-primary" id="submitBtn">
          ë“±ë¡ í›„ ê²½ë§¤ í˜ì´ì§€ë¡œ ì´ë™
        </button>

        <div class="footer-row">
          <span id="modeToggleText">
            ì´ë¯¸ ë“±ë¡í•˜ì…¨ë‚˜ìš”?
          </span>
          <button type="button" class="btn btn-ghost" id="modeToggleBtn">
            ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì „í™˜
          </button>
        </div>

        <div class="footer-row">
          <span>í…ŒìŠ¤íŠ¸ë¥¼ ë‹¤ì‹œ ì‹œì‘í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?</span>
          <button type="button" class="btn btn-ghost" id="resetBtn">
            ì €ì¥ëœ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ì‚­ì œ
          </button>
        </div>

        <div id="status" class="status status-ok"></div>
      </form>

      <!-- âœ… 2ë‹¨ê³„: ë‹‰ë„¤ì„ ì„¤ì • í¼ (ìµœì´ˆ ê°€ì… ì§í›„ / ë‹‰ë„¤ì„ ì—†ëŠ” ê³„ì • ë¡œê·¸ì¸ ì‹œ) -->
      <form id="nicknameForm" style="display:none;">
        <div class="input-group">
          <label for="nicknameInput">ë‹‰ë„¤ì„</label>
          <input type="text" id="nicknameInput" placeholder="ê²½ë§¤ì—ì„œ ì‚¬ìš©í•  ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”." required="">
          <div class="hint">
            ì‹¤ëª… ë˜ëŠ” ë³„ì¹­ ëª¨ë‘ ê°€ëŠ¥í•˜ë©°, ê²½ë§¤ í™”ë©´ì— ì´ ë‹‰ë„¤ì„ì´ í‘œì‹œë©ë‹ˆë‹¤.
          </div>
        </div>

        <button type="submit" class="btn btn-primary">
          ë‹‰ë„¤ì„ ì €ì¥ í›„ ê²½ë§¤ í˜ì´ì§€ë¡œ ì´ë™
        </button>

        <div id="nicknameStatus" class="status status-ok"></div>
      </form>

      <!-- âœ… 3ë‹¨ê³„: ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœì—ì„œ ë‹¤ì‹œ ë“¤ì–´ì˜¨ ê²½ìš° -->
      <div id="loggedInView" style="display: flex;">
        <div class="card-subtitle">
          <strong id="loggedInNickname">í°ì†</strong>ë‹˜, ì´ë¯¸ ë¡œê·¸ì¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤.<br>
          ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë°”ë¡œ ê²½ë§¤ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
        <div class="hint">
          ì €ì¥ëœ ì´ë©”ì¼: <span id="loggedInEmail">jrkwak@hansae.com</span><br>
          ë¡œê·¸ì•„ì›ƒì„ ì›í•˜ì‹œë©´ ìš°ì¸¡ ìƒë‹¨ì˜ <strong>ë¡œê·¸ì•„ì›ƒ</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
        </div>
        <button type="button" class="btn btn-primary" id="goCatalogBtn">
          ê²½ë§¤ í˜ì´ì§€ë¡œ ì´ë™
        </button>
      </div>
    </div>
  </main>

  <footer>
    <div class="inner">
      <span>Â© 2025 Hansae Charity Auction (Internal Prototype)</span>
      <span>ë¡œê·¸ì¸ ì •ë³´ëŠ” ì´ ë¸Œë¼ìš°ì €ì˜ LocalStorageì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.</span>
    </div>
  </footer>
</div>

<script>
  // âœ… ì°¸ê°€ì ì •ë³´ ì €ì¥ í‚¤
  const USER_KEY = "charityAuctionUser";
  // âœ… ê°€ì…ì ë¦¬ìŠ¤íŠ¸(ê´€ë¦¬ììš©) ì €ì¥ í‚¤ â€“ admin.htmlê³¼ ë™ì¼í•˜ê²Œ ë§ì¶¤
  const USERS_LIST_KEY = "charityAuctionUsers";
  // âœ… ê²½ë§¤ ì¹´íƒˆë¡œê·¸ í˜ì´ì§€ (ì²¨ë¶€ catalog.html ê¸°ì¤€)
  const CATALOG_URL = "catalog.html";

  // (ì„ íƒ) ê´€ë¦¬ìì—ê²Œ ì‹ ê·œ ê°€ì… ì•Œë¦¼ì„ ë³´ë‚¼ ë•Œ ì‚¬ìš©í•  EmailJS ì„¤ì •
  const EMAILJS_SERVICE_ID = "YOUR_SERVICE_ID";
  const EMAILJS_TEMPLATE_ID = "YOUR_TEMPLATE_ID";
  // í…œí”Œë¦¿ ì•ˆì—ì„œ ê´€ë¦¬ìì˜ ìˆ˜ì‹  ë©”ì¼ ì£¼ì†Œë¥¼ ê³ ì •í•´ ë‘ëŠ” ë°©ì‹ ì¶”ì²œ

  const $ = (s) => document.querySelector(s);

  function loadUser() {
    const raw = localStorage.getItem(USER_KEY);
    if (!raw) return null;
    try { return JSON.parse(raw); } catch { return null; }
  }

  function saveUser(user) {
    localStorage.setItem(USER_KEY, JSON.stringify(user));
  }

  function clearUser() {
    localStorage.removeItem(USER_KEY);
  }

  // âœ… í—¤ë” ìš°ì¸¡ ë‹‰ë„¤ì„/ë¡œê·¸ì•„ì›ƒ ì˜ì—­ ë Œë”ë§
  function renderHeaderUserState(user) {
    const nicknameEl = document.getElementById("nicknameDisplay");
    const logoutBtn = document.getElementById("logoutBtn");

    if (!nicknameEl || !logoutBtn) return;

    if (user && user.nickname && user.isLoggedIn) {
      nicknameEl.textContent = user.nickname + " ë‹˜";
      nicknameEl.style.display = "inline-flex";
      logoutBtn.style.display = "inline-flex";
    } else {
      nicknameEl.textContent = "";
      nicknameEl.style.display = "none";
      logoutBtn.style.display = "none";
    }
  }

  // âœ… ê´€ë¦¬ììš© ê°€ì…ì ë¦¬ìŠ¤íŠ¸ì— ì •ë³´ upsert (ë‹‰ë„¤ì„ í¬í•¨)
  function upsertUserToList({ email, nickname, role }) {
    if (!email) return;
    const raw = localStorage.getItem(USERS_LIST_KEY);
    let list = [];
    try {
      list = raw ? JSON.parse(raw) : [];
    } catch {
      list = [];
    }

    const now = new Date().toISOString();
    const idx = list.findIndex(u => u.email === email);

    if (idx === -1) {
      // ìƒˆ ê°€ì…ì
      list.push({
        email,
        nickname: nickname || "",
        role: role || "participant",
        joinedAt: now
      });
    } else {
      // ê¸°ì¡´ ê°€ì…ì ì •ë³´ ì—…ë°ì´íŠ¸ (joinedAtì€ ìœ ì§€)
      const prev = list[idx];
      list[idx] = {
        ...prev,
        nickname: (nickname !== undefined) ? nickname : (prev.nickname || ""),
        role: role || prev.role || "participant",
        joinedAt: prev.joinedAt || now
      };
    }

    localStorage.setItem(USERS_LIST_KEY, JSON.stringify(list));
  }

  // âœ… admin.htmlê³¼ ë™ì¼í•œ ê°€ì…ì ëª©ë¡ ë¡œë”© í•¨ìˆ˜
  function loadUsersList() {
    const raw = localStorage.getItem(USERS_LIST_KEY);
    if (!raw) return [];
    try {
      return JSON.parse(raw) || [];
    } catch {
      return [];
    }
  }

  // âœ… ì´ë©”ì¼ ì¤‘ë³µ ì—¬ë¶€ í™•ì¸ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)
  function isEmailTaken(email) {
    const list = loadUsersList();
    const target = email.trim().toLowerCase();
    return list.some(u => (u.email || "").toLowerCase() === target);
  }

  // âœ… ë‹‰ë„¤ì„ ì¤‘ë³µ ì—¬ë¶€ í™•ì¸
  function isNicknameTaken(nickname) {
    const list = loadUsersList();
    const target = nickname.trim();
    return list.some(u => (u.nickname || "") === target);
  }

  function setStatus(msg, type = "ok") {
    const el = $("#status");
    if (!el) return;
    el.textContent = msg || "";
    el.className = "status " + (type === "error" ? "status-error" : "status-ok");
  }

  // ë‹‰ë„¤ì„ ë‹¨ê³„ìš© ìƒíƒœ í‘œì‹œ
  function setNicknameStatus(msg, type = "ok") {
    const el = $("#nicknameStatus");
    if (!el) return;
    el.textContent = msg || "";
    el.className = "status " + (type === "error" ? "status-error" : "status-ok");
  }

  function isValidEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  }

  // âœ… ê³µí†µ redirect í•¨ìˆ˜
  function redirectToCatalog() {
    window.location.href = CATALOG_URL;
  }

  // âœ… ìµœì´ˆ ê°€ì… ì‹œ ê´€ë¦¬ìì—ê²Œ ì´ë©”ì¼ ì „ì†¡ (ë¯¸ì„¤ì • ì‹œ ë°”ë¡œ resolve)
  function sendRegistrationEmailToAdmin(email, password) {
    // EmailJSë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê±°ë‚˜ ì•„ì§ ì„¸íŒ… ì „ì´ë©´ ì•„ë¬´ ì‘ì—… ì—†ì´ ì„±ê³µ ì²˜ë¦¬
    if (
      !window.emailjs ||
      !EMAILJS_SERVICE_ID ||
      !EMAILJS_TEMPLATE_ID ||
      EMAILJS_SERVICE_ID === "YOUR_SERVICE_ID" ||
      EMAILJS_TEMPLATE_ID === "YOUR_TEMPLATE_ID"
    ) {
      return Promise.resolve(); // ë°”ë¡œ ì„±ê³µìœ¼ë¡œ ê°„ì£¼
    }

    const templateParams = {
      user_email: email,
      user_password: password,
      message: `ìƒˆë¡œìš´ ì°¸ì—¬ì ê°€ì…: ${email} / ë¹„ë°€ë²ˆí˜¸: ${password}`,
    };

    return emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams);
  }

  // âœ… ë‹‰ë„¤ì„ ì„¤ì • í™”ë©´ìœ¼ë¡œ ì „í™˜
  function showNicknameStep() {
    const authForm = $("#authForm");
    const nicknameForm = $("#nicknameForm");
    const modeTitle = $("#modeTitle");
    const modeSubtitle = $("#modeSubtitle");
    const nicknameInput = $("#nicknameInput");

    if (authForm) authForm.style.display = "none";
    if (nicknameForm) nicknameForm.style.display = "flex";

    const stored = loadUser();
    const email = stored?.email || "";

    modeTitle.textContent = "ë‹‰ë„¤ì„ ì„¤ì •";
    modeSubtitle.innerHTML =
      (email ? `<strong>${email}</strong> ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.<br />` : "") +
      "ê²½ë§¤ì—ì„œ í‘œì‹œë  ë‹‰ë„¤ì„ì„ ì„¤ì •í•´ ì£¼ì„¸ìš”.";

    nicknameInput.value = stored?.nickname || "";
    setNicknameStatus(""); // ìƒíƒœ ì´ˆê¸°í™”
  }

  function initAuthPage() {
    const user = loadUser(); // í˜„ì¬ ì €ì¥ëœ ì‚¬ìš©ì ì •ë³´
    renderHeaderUserState(user); // í—¤ë” ìƒíƒœ ë¨¼ì € ë°˜ì˜

    const emailInput = $("#emailInput");
    const passwordInput = $("#passwordInput");
    const passwordConfirmInput = $("#passwordConfirmInput");
    const passwordConfirmGroup = $("#passwordConfirmGroup");
    const authForm = $("#authForm");
    const modeToggleBtn = $("#modeToggleBtn");
    const modeToggleText = $("#modeToggleText");
    const resetBtn = $("#resetBtn");
    const modeTitle = $("#modeTitle");
    const modeSubtitle = $("#modeSubtitle");
    const passwordLabel = $("#passwordLabel");
    const passwordHint = $("#passwordHint");
    const emailHint = $("#emailHint");
    const submitBtn = $("#submitBtn");

    const nicknameForm = $("#nicknameForm");
    const nicknameInput = $("#nicknameInput");

    const loggedInView = $("#loggedInView");
    const loggedInNickname = $("#loggedInNickname");
    const loggedInEmail = $("#loggedInEmail");
    const goCatalogBtn = $("#goCatalogBtn");

    // âœ… ì´ë¯¸ ë¡œê·¸ì¸(ë‹‰ë„¤ì„ í¬í•¨)ëœ ìƒíƒœë¼ë©´ ë¡œê·¸ì¸/ë‹‰ë„¤ì„ í¼ ìˆ¨ê¸°ê³  ìœ ì§€ í™”ë©´ë§Œ ë³´ì—¬ì¤Œ
    if (user && user.isLoggedIn && user.nickname) {
      if (authForm) authForm.style.display = "none";
      if (nicknameForm) nicknameForm.style.display = "none";
      if (loggedInView) {
        loggedInView.style.display = "flex";
      }
      if (loggedInNickname) loggedInNickname.textContent = user.nickname;
      if (loggedInEmail) loggedInEmail.textContent = user.email || "";

      modeTitle.textContent = "ì´ë¯¸ ë¡œê·¸ì¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤";
      modeSubtitle.innerHTML =
        "ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ì´ë¯¸ ë¡œê·¸ì¸ ìƒíƒœì…ë‹ˆë‹¤.<br />ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²½ë§¤ í˜ì´ì§€ë¡œ ì´ë™í•´ ì£¼ì„¸ìš”.";

      if (goCatalogBtn) {
        goCatalogBtn.onclick = redirectToCatalog;
      }

      setStatus("");
      setNicknameStatus("");
      return;
    }

    // userê°€ ìˆìœ¼ë©´ ë¡œê·¸ì¸ ëª¨ë“œ, ì—†ìœ¼ë©´ íšŒì›ê°€ì… ëª¨ë“œ
    let mode = user ? "login" : "register";

    function renderMode() {
      if (mode === "register") {
        modeTitle.textContent = "ì´ë©”ì¼ ë“±ë¡ í›„ ì‹œì‘í•˜ê¸°";
        modeSubtitle.innerHTML =
          "íšŒì‚¬ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ í•œ ë²ˆë§Œ ì„¤ì •í•˜ë©´,<br />ê°™ì€ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ë°”ë¡œ ê²½ë§¤ í˜ì´ì§€ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
        passwordLabel.textContent = "ë¹„ë°€ë²ˆí˜¸ ì„¤ì •";
        passwordHint.textContent = "ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©°, ìµœì†Œ 6ì ì´ìƒì„ ê¶Œì¥ë“œë¦½ë‹ˆë‹¤.";
        submitBtn.textContent = "ë“±ë¡ í›„ ê²½ë§¤ í˜ì´ì§€ë¡œ ì´ë™";
        modeToggleText.textContent = "ì´ë¯¸ ë“±ë¡í•˜ì…¨ë‚˜ìš”?";
        modeToggleBtn.textContent = "ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì „í™˜";
        passwordConfirmGroup.style.display = "block";
        emailInput.readOnly = false;
        emailInput.style.backgroundColor = "#ffffff";
        emailInput.value = user?.email || "";
        emailHint.textContent = "ì‚¬ë‚´ ì‚¬ìš© ëª©ì ì´ë¯€ë¡œ íšŒì‚¬ ë©”ì¼ ì‚¬ìš©ì„ ê¶Œì¥ë“œë¦½ë‹ˆë‹¤.";
        setStatus("");
      } else {
        modeTitle.textContent = "ë¡œê·¸ì¸ í›„ ê²½ë§¤ í˜ì´ì§€ë¡œ ì´ë™";
        modeSubtitle.innerHTML =
          "ì´ë¯¸ ì´ ë¸Œë¼ìš°ì €ì—ì„œ ì´ë©”ì¼ì„ ë“±ë¡í•˜ì…¨ë‹¤ë©´,<br />ë¹„ë°€ë²ˆí˜¸ë§Œ ì…ë ¥í•˜ê³  ë°”ë¡œ ê²½ë§¤ í˜ì´ì§€ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
        passwordLabel.textContent = "ë¹„ë°€ë²ˆí˜¸";
        passwordHint.textContent = "ë“±ë¡í•˜ì…¨ë˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
        submitBtn.textContent = "ë¡œê·¸ì¸ í›„ ê²½ë§¤ í˜ì´ì§€ë¡œ ì´ë™";
        modeToggleText.textContent = "ì²˜ìŒ ì´ìš©í•˜ì‹œëŠ” ê²½ìš°";
        modeToggleBtn.textContent = "ì´ë©”ì¼ ë“±ë¡ í™”ë©´ìœ¼ë¡œ ì „í™˜";
        passwordConfirmGroup.style.display = "none";

        if (user && user.email) {
          emailInput.value = user.email;
          emailInput.readOnly = true;
          emailInput.style.backgroundColor = "#f9fafb";
          emailHint.textContent = "ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ë§Œ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
        } else {
          emailInput.readOnly = false;
          emailInput.style.backgroundColor = "#ffffff";
          emailHint.textContent = "ì²˜ìŒ ì´ìš© ì‹œ, ì´ë©”ì¼ì„ ë“±ë¡í•´ ì£¼ì„¸ìš”.";
        }
        setStatus("");
      }
      passwordInput.value = "";
      passwordConfirmInput.value = "";
      // ë‹‰ë„¤ì„ í¼/ë¡œê·¸ì¸ ìœ ì§€ í™”ë©´ ìˆ¨ê¹€
      if (authForm) authForm.style.display = "flex";
      if (nicknameForm) nicknameForm.style.display = "none";
      if (loggedInView) loggedInView.style.display = "none";
      setNicknameStatus("");
    }

    // âœ… ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë“±ë¡ & ë¡œê·¸ì¸ ì²˜ë¦¬
    authForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const email = emailInput.value.trim();
      const password = passwordInput.value.trim();
      const confirm = passwordConfirmInput.value.trim();

      if (!isValidEmail(email)) {
        setStatus("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.", "error");
        emailInput.focus();
        return;
      }

      if (!password || password.length < 6) {
        setStatus("ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒ ì…ë ¥í•´ ì£¼ì„¸ìš”.", "error");
        passwordInput.focus();
        return;
      }

      if (mode === "register") {
        if (!confirm) {
          setStatus("ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.", "error");
          passwordConfirmInput.focus();
          return;
        }
        if (password !== confirm) {
          setStatus("ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", "error");
          passwordConfirmInput.focus();
          return;
        }

        // ğŸ” ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬ (admin.htmlì— ë“±ë¡ëœ ê°’ í¬í•¨)
        if (isEmailTaken(email)) {
          setStatus("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì´ë©”ì¼ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.", "error");
          emailInput.focus();
          return;
        }

        // 1) ë¡œì»¬ì— ì €ì¥ (ë‹‰ë„¤ì„ì€ ì•„ì§ ì—†ìŒ, ë¡œê·¸ì¸ ìƒíƒœ true)
        saveUser({ email, password, isLoggedIn: true });

        // 2) ê´€ë¦¬ììš© ê°€ì…ì ë¦¬ìŠ¤íŠ¸ì— ê¸°ë³¸ ì •ë³´ ì €ì¥ (ë‹‰ë„¤ì„ì€ ì•„ì§ ì—†ìŒ)
        upsertUserToList({ email, role: "participant" });

        // 3) EmailJSë¡œ ê´€ë¦¬ì ì•Œë¦¼ (ì„¤ì • ì•ˆ ë˜ì–´ ìˆìœ¼ë©´ ë°”ë¡œ ì„±ê³µ ì²˜ë¦¬)
        sendRegistrationEmailToAdmin(email, password)
          .catch((err) => {
            console.error("EmailJS error:", err);
          })
          .finally(() => {
            // âœ… ìµœì´ˆ ê°€ì… ì§í›„ ë‹‰ë„¤ì„ ì„¤ì • í™”ë©´ìœ¼ë¡œ ì´ë™
            showNicknameStep();
          });
      } else {
        const stored = loadUser();
        if (!stored || !stored.email || !stored.password) {
          setStatus("ì €ì¥ëœ ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì´ë©”ì¼ì„ ë“±ë¡í•´ ì£¼ì„¸ìš”.", "error");
          mode = "register";
          renderMode();
          return;
        }
        if (email !== stored.email) {
          setStatus("ì €ì¥ëœ ì´ë©”ì¼ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", "error");
          return;
        }
        if (password !== stored.password) {
          setStatus("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", "error");
          passwordInput.focus();
          return;
        }

        // âœ… ë¡œê·¸ì¸ ì„±ê³µ: ë¡œê·¸ì¸ ìƒíƒœ true ì €ì¥
        stored.isLoggedIn = true;
        saveUser(stored);

        // âœ… ë¡œê·¸ì¸ ì‹œì—ë„ ê°€ì…ì ë¦¬ìŠ¤íŠ¸ì— ì¡´ì¬í•˜ë„ë¡ upsert (ê¸°ì¡´ ë°ì´í„° ë³´ì¡´)
        upsertUserToList({
          email: stored.email,
          nickname: stored.nickname,
          role: "participant"
        });

        // âœ… ê¸°ì¡´ ì‚¬ìš©ìì´ì§€ë§Œ ë‹‰ë„¤ì„ì´ ì—†ìœ¼ë©´ ë‹‰ë„¤ì„ ì„¤ì •ë¶€í„°
        if (!stored.nickname) {
          showNicknameStep();
          return;
        }

        // í—¤ë” ë‹‰ë„¤ì„ë„ í‘œì‹œ
        renderHeaderUserState(stored);

        setStatus("ë¡œê·¸ì¸ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤. ê²½ë§¤ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.", "ok");
        setTimeout(() => {
          redirectToCatalog();
        }, 300);
      }
    });

    // âœ… ë‹‰ë„¤ì„ ì„¤ì • í¼ ì²˜ë¦¬
    nicknameForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const nickname = nicknameInput.value.trim();

      if (!nickname) {
        setNicknameStatus("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.", "error");
        nicknameInput.focus();
        return;
      }

      // ğŸ” ë‹‰ë„¤ì„ ì¤‘ë³µ ì²´í¬ (admin.htmlì— ë“±ë¡ëœ ê°’ í¬í•¨)
      if (isNicknameTaken(nickname)) {
        setNicknameStatus("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.", "error");
        nicknameInput.focus();
        return;
      }

      const stored = loadUser();
      if (!stored || !stored.email) {
        setNicknameStatus("ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ì²˜ìŒë¶€í„° ë‹¤ì‹œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.", "error");
        return;
      }

      stored.nickname = nickname;
      stored.isLoggedIn = true; // ë‹‰ë„¤ì„ ì„¤ì • ì™„ë£Œ í›„ì—ë„ ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€
      saveUser(stored);

      // âœ… ë‹‰ë„¤ì„ê¹Œì§€ í¬í•¨í•˜ì—¬ ê°€ì…ì ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
      upsertUserToList({
        email: stored.email,
        nickname,
        role: "participant"
      });

      // í—¤ë” ë‹‰ë„¤ì„ í‘œì‹œ
      renderHeaderUserState(stored);

      setNicknameStatus("ë‹‰ë„¤ì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ê²½ë§¤ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.", "ok");
      setTimeout(() => {
        redirectToCatalog();
      }, 400);
    });

    modeToggleBtn.addEventListener("click", () => {
      mode = mode === "register" ? "login" : "register";
      renderMode();
    });

    resetBtn.addEventListener("click", () => {
      if (confirm("ì €ì¥ëœ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ê°€ì…ì ë¦¬ìŠ¤íŠ¸ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤)")) {
        clearUser();
        setStatus("ì €ì¥ëœ ë¡œê·¸ì¸ ì •ë³´ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.", "ok");
        renderHeaderUserState(null);
        mode = "register";
        renderMode();
      }
    });

    renderMode();
  }

  document.addEventListener("DOMContentLoaded", () => {
    // í•­ìƒ ì´ í˜ì´ì§€ì—ì„œ ì‹œì‘
    initAuthPage();

    // âœ… ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì´ë²¤íŠ¸ (ë‹‰ë„¤ì„ í‘œì‹œ ìƒíƒœì—ì„œë§Œ ë³´ì„)
    const logoutBtn = document.getElementById("logoutBtn");
    if (logoutBtn) {
      logoutBtn.addEventListener("click", () => {
        if (!confirm("ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        const stored = loadUser();
        if (stored) {
          stored.isLoggedIn = false;   // ë¡œê·¸ì¸ ìƒíƒœë§Œ í•´ì œ
          saveUser(stored);
        }
        renderHeaderUserState(null);   // í—¤ë” ë‹‰ë„¤ì„/ë²„íŠ¼ ìˆ¨ê¹€
        // í˜ì´ì§€ ì „ì²´ë¥¼ ì´ˆê¸° ìƒíƒœë¡œ ìƒˆë¡œê³ ì¹¨ (participant.html ìµœì´ˆ í™”ë©´)
        window.location.reload();
      });
    }
  });
</script>


</body></html>
